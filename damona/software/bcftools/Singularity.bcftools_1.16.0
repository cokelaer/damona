Bootstrap: docker
From: python:3.11-slim

%post

    set -eux

    apt-get update -y 

    apt-cache search libncurses
   
    apt-cache search libcurl
 
    apt-get install -y git build-essential \
            wget gcc make git libbz2-dev zlib1g zlib1g-dev \
            liblzma5 liblzma-dev libncurses6 libncurses-dev bzip2 \
            libcurl4-openssl-dev libssl-dev libgetopt-complete-perl

    export VERSION=1.16
    export HTSVERSION=1.16

    cd /usr/local/ \
        && git clone https://github.com/samtools/htslib.git \
        && cd htslib && git checkout ${HTSVERSION} \
        && git submodule update --init --recursive \
        && make \
        && cd .. \
        && git clone https://github.com/samtools/bcftools.git \
        && cd bcftools \
        && git checkout ${VERSION} \
        && make \
        && make install

    # cleanup
    cd /
    rm -rf /usr/local/bcftools /usr/local/htslib
    apt-get purge -y wget gcc make build-essential git \
        libbz2-dev zlib1g-dev liblzma-dev libncurses-dev \
        libssl-dev libgetopt-complete-perl

    # the purge removes libcurl4 because not used by other lib...
    apt-get install -y libcurl4

    apt autoremove -y
    apt clean -y
    rm -rf /var/lib/apt/lists/*


%runscript
    exec bcftools "$@"

